2025-04-25 00:03:46,783 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-25 00:03:56,184 - test_autobkp - ERROR - Lỗi khi import các module: cannot import name 'train_customer_model' from 'app.scripts.train' (D:\Python\AutoBKP_V2\app\scripts\train.py)
2025-04-25 00:03:56,187 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-25 00:03:56,187 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_71j14pf9
2025-04-25 00:03:56,188 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-25 00:03:56,188 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-25 00:03:56,188 - test_autobkp - ERROR - Không thể import các module cần thiết
2025-04-25 00:03:56,189 - test_autobkp - ERROR - ✗ Kiểm tra cấu hình thất bại
2025-04-25 00:03:56,189 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-25 00:27:46,287 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-25 00:27:47,478 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-25 00:27:47,478 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_ltfkzh99
2025-04-25 00:27:47,478 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-25 00:27:47,478 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-25 00:27:47,478 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-25 00:27:47,479 - config_manager - INFO - Tạo cấu hình mới cho khách hàng test_customer
2025-04-25 00:27:47,480 - config_manager - INFO - Đã lưu cấu hình cho khách hàng test_customer
2025-04-25 00:27:47,480 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-25 00:27:47,480 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-25 00:27:47,480 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-25 00:27:47,480 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-25 00:27:47,483 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_ltfkzh99\test_customer_sample_data.csv
2025-04-25 00:27:47,483 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-25 00:27:47,483 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-25 00:27:47,484 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_ltfkzh99\test_customer_sample_data.csv
2025-04-25 00:27:47,510 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-25 00:27:47,532 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-25 00:27:47,533 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-25 00:27:47,533 - test_autobkp - INFO - Kết quả validate: valid
2025-04-25 00:27:47,534 - test_autobkp - ERROR - Lỗi khi kiểm tra chức năng validate_data: Object of type bool is not JSON serializable
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\test_autobkp.py", line 287, in test_validate_data
    json.dump(result, f, ensure_ascii=False, indent=2)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\__init__.py", line 179, in dump
    for chunk in iterable:
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type bool is not JSON serializable
2025-04-25 00:27:47,579 - test_autobkp - ERROR - ✗ Kiểm tra chức năng validate_data thất bại
2025-04-25 00:27:47,580 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-25 00:33:48,714 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-25 00:33:49,811 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-25 00:33:49,811 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_0_9qy3mj
2025-04-25 00:33:49,811 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-25 00:33:49,811 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-25 00:33:49,811 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-25 00:33:49,813 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-25 00:33:49,813 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-25 00:33:49,813 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-25 00:33:49,813 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-25 00:33:49,816 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_0_9qy3mj\test_customer_sample_data.csv
2025-04-25 00:33:49,816 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-25 00:33:49,816 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-25 00:33:49,816 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_0_9qy3mj\test_customer_sample_data.csv
2025-04-25 00:33:49,851 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-25 00:33:49,855 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-25 00:33:49,855 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-25 00:33:49,856 - test_autobkp - INFO - Kết quả validate: valid
2025-04-25 00:33:49,856 - test_autobkp - ERROR - Lỗi khi kiểm tra chức năng validate_data: Type <class 'numpy.bool'> not serializable
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\test_autobkp.py", line 302, in test_validate_data
    json.dump(result, f, ensure_ascii=False, indent=2, default=json_serializable)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\__init__.py", line 179, in dump
    for chunk in iterable:
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 432, in _iterencode
    yield from _iterencode_dict(o, _current_indent_level)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 406, in _iterencode_dict
    yield from chunks
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\json\encoder.py", line 439, in _iterencode
    o = _default(o)
        ^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\test_autobkp.py", line 298, in json_serializable
    raise TypeError(f"Type {type(obj)} not serializable")
TypeError: Type <class 'numpy.bool'> not serializable
2025-04-25 00:33:49,858 - test_autobkp - ERROR - ✗ Kiểm tra chức năng validate_data thất bại
2025-04-25 00:33:49,858 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-25 00:36:15,350 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-25 00:36:16,498 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-25 00:36:16,500 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5
2025-04-25 00:36:16,500 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-25 00:36:16,500 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-25 00:36:16,500 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-25 00:36:16,501 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-25 00:36:16,501 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-25 00:36:16,501 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-25 00:36:16,501 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-25 00:36:16,504 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_sample_data.csv
2025-04-25 00:36:16,504 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-25 00:36:16,504 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-25 00:36:16,504 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_sample_data.csv
2025-04-25 00:36:16,533 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-25 00:36:16,538 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-25 00:36:16,538 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-25 00:36:16,539 - test_autobkp - INFO - Kết quả validate: valid
2025-04-25 00:36:16,539 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\validate_result.json
2025-04-25 00:36:16,539 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-25 00:36:16,539 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-25 00:36:16,539 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-25 00:36:16,539 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-25 00:36:16,541 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_sample_data.csv
2025-04-25 00:36:16,542 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-25 00:36:16,543 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_sample_data.csv
2025-04-25 00:36:16,543 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-25 00:36:16,546 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-25 00:36:16,547 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-25 00:36:16,548 - preprocess - INFO - Số lượng lớp: 15
2025-04-25 00:36:16,548 - preprocess - INFO - Tỷ lệ mất cân bằng: 2.50
2025-04-25 00:36:16,548 - preprocess - INFO - Lớp hiếm nhất có 4 mẫu (4.00%)
2025-04-25 00:36:16,548 - preprocess - INFO - Lớp phổ biến nhất có 10 mẫu (10.00%)
2025-04-25 00:36:16,549 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-25 00:36:16,549 - preprocess - INFO - Số lượng lớp: 10
2025-04-25 00:36:16,551 - preprocess - INFO - Tỷ lệ mất cân bằng: 7.00
2025-04-25 00:36:16,551 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (2.56%)
2025-04-25 00:36:16,551 - preprocess - INFO - Lớp phổ biến nhất có 7 mẫu (17.95%)
2025-04-25 00:36:16,551 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-25 00:36:16,552 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-25 00:36:16,552 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-25 00:36:16,556 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_train_20250425_003616.csv
2025-04-25 00:36:16,557 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_test_20250425_003616.csv
2025-04-25 00:36:16,557 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_metadata_20250425_003616.json
2025-04-25 00:36:16,557 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_metadata_20250425_003616.json
2025-04-25 00:36:16,557 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-25 00:36:16,559 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_train_20250425_003616.csv
2025-04-25 00:36:16,559 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_ii8gvhk5\test_customer_test_20250425_003616.csv
2025-04-25 00:36:16,603 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-25 00:36:16,604 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-25 00:36:16,604 - test_autobkp - ERROR - Thiếu cột mục tiêu chính HachToan trong tập huấn luyện
2025-04-25 00:36:16,604 - test_autobkp - ERROR - ✗ Kiểm tra chức năng tiền xử lý thất bại
2025-04-25 00:36:16,604 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-25 00:42:13,015 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-25 00:42:14,129 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-25 00:42:14,129 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6
2025-04-25 00:42:14,129 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-25 00:42:14,129 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-25 00:42:14,129 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-25 00:42:14,130 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-25 00:42:14,130 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-25 00:42:14,130 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-25 00:42:14,130 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-25 00:42:14,132 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_sample_data.csv
2025-04-25 00:42:14,132 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-25 00:42:14,133 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-25 00:42:14,133 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_sample_data.csv
2025-04-25 00:42:14,159 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-25 00:42:14,163 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-25 00:42:14,163 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-25 00:42:14,164 - test_autobkp - INFO - Kết quả validate: valid
2025-04-25 00:42:14,164 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\validate_result.json
2025-04-25 00:42:14,164 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-25 00:42:14,166 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-25 00:42:14,166 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-25 00:42:14,166 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-25 00:42:14,166 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_sample_data.csv
2025-04-25 00:42:14,168 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-25 00:42:14,168 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_sample_data.csv
2025-04-25 00:42:14,168 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-25 00:42:14,169 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-25 00:42:14,170 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-25 00:42:14,170 - preprocess - INFO - Số lượng lớp: 15
2025-04-25 00:42:14,171 - preprocess - INFO - Tỷ lệ mất cân bằng: 3.00
2025-04-25 00:42:14,171 - preprocess - INFO - Lớp hiếm nhất có 4 mẫu (4.00%)
2025-04-25 00:42:14,171 - preprocess - INFO - Lớp phổ biến nhất có 12 mẫu (12.00%)
2025-04-25 00:42:14,172 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-25 00:42:14,172 - preprocess - INFO - Số lượng lớp: 9
2025-04-25 00:42:14,172 - preprocess - INFO - Tỷ lệ mất cân bằng: 6.00
2025-04-25 00:42:14,172 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (3.03%)
2025-04-25 00:42:14,172 - preprocess - INFO - Lớp phổ biến nhất có 6 mẫu (18.18%)
2025-04-25 00:42:14,172 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-25 00:42:14,173 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-25 00:42:14,173 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-25 00:42:14,177 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_train_20250425_004214.csv
2025-04-25 00:42:14,178 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_test_20250425_004214.csv
2025-04-25 00:42:14,178 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_metadata_20250425_004214.json
2025-04-25 00:42:14,179 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_metadata_20250425_004214.json
2025-04-25 00:42:14,179 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-25 00:42:14,179 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_train_20250425_004214.csv
2025-04-25 00:42:14,179 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_test_20250425_004214.csv
2025-04-25 00:42:14,228 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-25 00:42:14,228 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-25 00:42:14,228 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-25 00:42:14,229 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-25 00:42:14,229 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-25 00:42:14,229 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-25 00:42:14,230 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_train_20250425_004214.csv
2025-04-25 00:42:14,231 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_tnedjzq6\test_customer_test_20250425_004214.csv
2025-04-25 00:42:14,232 - train - ERROR - Lỗi khi huấn luyện mô hình: 'ModelTrainer' object has no attribute 'train_hachtoan_model'
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1641, in train_customer_model
    trainer.train_hachtoan_model(train_df)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'ModelTrainer' object has no attribute 'train_hachtoan_model'. Did you mean: 'hachtoan_model'?
2025-04-25 00:42:14,234 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: 'ModelTrainer' object has no attribute 'train_hachtoan_model'
2025-04-25 00:42:14,234 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-25 00:42:14,234 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-25 00:49:36,177 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-25 00:49:37,277 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-25 00:49:37,279 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej
2025-04-25 00:49:37,279 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-25 00:49:37,279 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-25 00:49:37,279 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-25 00:49:37,279 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-25 00:49:37,279 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-25 00:49:37,279 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-25 00:49:37,279 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-25 00:49:37,282 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_sample_data.csv
2025-04-25 00:49:37,282 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-25 00:49:37,282 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-25 00:49:37,282 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_sample_data.csv
2025-04-25 00:49:37,312 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-25 00:49:37,316 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-25 00:49:37,316 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-25 00:49:37,317 - test_autobkp - INFO - Kết quả validate: valid
2025-04-25 00:49:37,318 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\validate_result.json
2025-04-25 00:49:37,318 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-25 00:49:37,319 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-25 00:49:37,319 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-25 00:49:37,319 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-25 00:49:37,320 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_sample_data.csv
2025-04-25 00:49:37,321 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-25 00:49:37,322 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_sample_data.csv
2025-04-25 00:49:37,322 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-25 00:49:37,324 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-25 00:49:37,324 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-25 00:49:37,324 - preprocess - INFO - Số lượng lớp: 15
2025-04-25 00:49:37,326 - preprocess - INFO - Tỷ lệ mất cân bằng: 5.00
2025-04-25 00:49:37,326 - preprocess - INFO - Lớp hiếm nhất có 3 mẫu (3.00%)
2025-04-25 00:49:37,326 - preprocess - INFO - Lớp phổ biến nhất có 15 mẫu (15.00%)
2025-04-25 00:49:37,327 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-25 00:49:37,327 - preprocess - INFO - Số lượng lớp: 9
2025-04-25 00:49:37,328 - preprocess - INFO - Tỷ lệ mất cân bằng: 8.00
2025-04-25 00:49:37,328 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (3.03%)
2025-04-25 00:49:37,328 - preprocess - INFO - Lớp phổ biến nhất có 8 mẫu (24.24%)
2025-04-25 00:49:37,328 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-25 00:49:37,329 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-25 00:49:37,329 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-25 00:49:37,340 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_train_20250425_004937.csv
2025-04-25 00:49:37,340 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_test_20250425_004937.csv
2025-04-25 00:49:37,341 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_metadata_20250425_004937.json
2025-04-25 00:49:37,341 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_metadata_20250425_004937.json
2025-04-25 00:49:37,341 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-25 00:49:37,342 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_train_20250425_004937.csv
2025-04-25 00:49:37,342 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_test_20250425_004937.csv
2025-04-25 00:49:37,398 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-25 00:49:37,398 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-25 00:49:37,399 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-25 00:49:37,399 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-25 00:49:37,399 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-25 00:49:37,400 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-25 00:49:37,401 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_train_20250425_004937.csv
2025-04-25 00:49:37,401 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_nk3c9gej\test_customer_test_20250425_004937.csv
2025-04-25 00:49:37,404 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-25 00:49:37,404 - train - INFO - Tiền xử lý dữ liệu...
2025-04-25 00:49:37,405 - train - INFO - Tạo feature extractor...
2025-04-25 00:49:37,405 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-25 00:49:37,406 - train - INFO - Trích xuất đặc trưng...
2025-04-25 00:49:37,406 - train - ERROR - Lỗi khi huấn luyện mô hình: OneHotEncoder.__init__() got an unexpected keyword argument 'sparse'
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1641, in train_customer_model
    trainer.train_hachtoan_model(train_df)
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 442, in train_hachtoan_model
    X_transformed = self.feature_extractor.fit_transform(X)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 222, in fit_transform
    return self.fit(df, y).transform(df)
           ^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 174, in fit
    encoder = OneHotEncoder(handle_unknown='ignore', sparse=False)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: OneHotEncoder.__init__() got an unexpected keyword argument 'sparse'
2025-04-25 00:49:37,408 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: OneHotEncoder.__init__() got an unexpected keyword argument 'sparse'
2025-04-25 00:49:37,408 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-25 00:49:37,408 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 00:18:51,230 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 00:18:58,800 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 00:18:58,802 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys
2025-04-26 00:18:58,802 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 00:18:58,803 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 00:18:58,803 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 00:18:58,811 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 00:18:58,811 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 00:18:58,811 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 00:18:58,811 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 00:18:58,814 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_sample_data.csv
2025-04-26 00:18:58,815 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 00:18:58,815 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 00:18:58,815 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_sample_data.csv
2025-04-26 00:18:58,843 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 00:18:58,848 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: warnings
2025-04-26 00:18:58,849 - validate_data - INFO - Tổng số cảnh báo: 1
2025-04-26 00:18:58,849 - test_autobkp - INFO - Kết quả validate: warnings
2025-04-26 00:18:58,850 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\validate_result.json
2025-04-26 00:18:58,850 - test_autobkp - WARNING - Tìm thấy 1 cảnh báo trong dữ liệu
2025-04-26 00:18:58,851 - test_autobkp - WARNING - - Class imbalance detected in primary target (severity: medium)
2025-04-26 00:18:58,851 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 00:18:58,851 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 00:18:58,851 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 00:18:58,851 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 00:18:58,853 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_sample_data.csv
2025-04-26 00:18:58,854 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 00:18:58,855 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_sample_data.csv
2025-04-26 00:18:58,856 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 00:18:58,857 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 00:18:58,858 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 00:18:58,858 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 00:18:58,859 - preprocess - INFO - Tỷ lệ mất cân bằng: 12.00
2025-04-26 00:18:58,859 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (1.00%)
2025-04-26 00:18:58,859 - preprocess - INFO - Lớp phổ biến nhất có 12 mẫu (12.00%)
2025-04-26 00:18:58,860 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 00:18:58,860 - preprocess - INFO - Số lượng lớp: 10
2025-04-26 00:18:58,861 - preprocess - INFO - Tỷ lệ mất cân bằng: 5.00
2025-04-26 00:18:58,861 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (2.86%)
2025-04-26 00:18:58,861 - preprocess - INFO - Lớp phổ biến nhất có 5 mẫu (14.29%)
2025-04-26 00:18:58,861 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 00:18:58,861 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 00:18:58,861 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 00:18:58,866 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_train_20250426_001858.csv
2025-04-26 00:18:58,866 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_test_20250426_001858.csv
2025-04-26 00:18:58,867 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_metadata_20250426_001858.json
2025-04-26 00:18:58,867 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_metadata_20250426_001858.json
2025-04-26 00:18:58,867 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 00:18:58,867 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_train_20250426_001858.csv
2025-04-26 00:18:58,867 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_test_20250426_001858.csv
2025-04-26 00:18:58,916 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 00:18:58,917 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 00:18:58,917 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 00:18:58,918 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 00:18:58,918 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 00:18:58,918 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 00:18:58,919 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_train_20250426_001858.csv
2025-04-26 00:18:58,921 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_aanq4pys\test_customer_test_20250426_001858.csv
2025-04-26 00:18:58,922 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 00:18:58,922 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 00:18:58,924 - train - INFO - Tạo feature extractor...
2025-04-26 00:18:58,924 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 00:18:58,925 - train - INFO - Trích xuất đặc trưng...
2025-04-26 00:18:58,925 - train - ERROR - Lỗi khi huấn luyện mô hình: OneHotEncoder.__init__() got an unexpected keyword argument 'sparse'
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1641, in train_customer_model
    trainer.train_hachtoan_model(train_df)
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 442, in train_hachtoan_model
    X_transformed = self.feature_extractor.fit_transform(X)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 222, in fit_transform
    return self.fit(df, y).transform(df)
           ^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 174, in fit
    encoder = OneHotEncoder(handle_unknown='ignore', sparse=False)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: OneHotEncoder.__init__() got an unexpected keyword argument 'sparse'
2025-04-26 00:18:58,970 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: OneHotEncoder.__init__() got an unexpected keyword argument 'sparse'
2025-04-26 00:18:58,971 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 00:18:58,971 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 00:26:55,785 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 00:26:56,858 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 00:26:56,859 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr
2025-04-26 00:26:56,859 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 00:26:56,859 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 00:26:56,859 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 00:26:56,859 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 00:26:56,859 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 00:26:56,859 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 00:26:56,860 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 00:26:56,861 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_sample_data.csv
2025-04-26 00:26:56,861 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 00:26:56,861 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 00:26:56,861 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_sample_data.csv
2025-04-26 00:26:56,894 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 00:26:56,898 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 00:26:56,899 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 00:26:56,899 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 00:26:56,900 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\validate_result.json
2025-04-26 00:26:56,900 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 00:26:56,900 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 00:26:56,900 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 00:26:56,900 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 00:26:56,902 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_sample_data.csv
2025-04-26 00:26:56,903 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 00:26:56,903 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_sample_data.csv
2025-04-26 00:26:56,904 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 00:26:56,906 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 00:26:56,906 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 00:26:56,907 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 00:26:56,907 - preprocess - INFO - Tỷ lệ mất cân bằng: 3.67
2025-04-26 00:26:56,907 - preprocess - INFO - Lớp hiếm nhất có 3 mẫu (3.00%)
2025-04-26 00:26:56,907 - preprocess - INFO - Lớp phổ biến nhất có 11 mẫu (11.00%)
2025-04-26 00:26:56,908 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 00:26:56,908 - preprocess - INFO - Số lượng lớp: 9
2025-04-26 00:26:56,909 - preprocess - INFO - Tỷ lệ mất cân bằng: 4.00
2025-04-26 00:26:56,909 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (4.17%)
2025-04-26 00:26:56,909 - preprocess - INFO - Lớp phổ biến nhất có 4 mẫu (16.67%)
2025-04-26 00:26:56,909 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 00:26:56,910 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 00:26:56,911 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 00:26:56,920 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_train_20250426_002656.csv
2025-04-26 00:26:56,920 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_test_20250426_002656.csv
2025-04-26 00:26:56,922 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_metadata_20250426_002656.json
2025-04-26 00:26:56,922 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_metadata_20250426_002656.json
2025-04-26 00:26:56,922 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 00:26:56,923 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_train_20250426_002656.csv
2025-04-26 00:26:56,923 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_test_20250426_002656.csv
2025-04-26 00:26:56,969 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 00:26:56,969 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 00:26:56,969 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 00:26:56,970 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 00:26:56,970 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 00:26:56,970 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 00:26:56,971 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_train_20250426_002656.csv
2025-04-26 00:26:56,973 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_jq2yynrr\test_customer_test_20250426_002656.csv
2025-04-26 00:26:56,974 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 00:26:56,974 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 00:26:56,976 - train - INFO - Tạo feature extractor...
2025-04-26 00:26:56,977 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 00:26:56,977 - train - INFO - Trích xuất đặc trưng...
2025-04-26 00:26:56,988 - train - ERROR - Lỗi khi huấn luyện mô hình: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1641, in train_customer_model
    trainer.train_hachtoan_model(train_df)
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 442, in train_hachtoan_model
    X_transformed = self.feature_extractor.fit_transform(X)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 222, in fit_transform
    return self.fit(df, y).transform(df)
           ^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 192, in fit
    self.feature_names = self._get_feature_names()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 275, in _get_feature_names
    col_names = [f"{column}_{feat}" for feat in transformer.get_feature_names_out()]
                                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 1276, in get_feature_names_out
    raise AttributeError(
AttributeError: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 00:26:57,003 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 00:26:57,003 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 00:26:57,004 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 00:38:38,990 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 00:38:40,123 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 00:38:40,124 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih
2025-04-26 00:38:40,124 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 00:38:40,124 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 00:38:40,124 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 00:38:40,131 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 00:38:40,131 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 00:38:40,132 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 00:38:40,132 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 00:38:40,135 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_sample_data.csv
2025-04-26 00:38:40,135 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 00:38:40,135 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 00:38:40,135 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_sample_data.csv
2025-04-26 00:38:40,160 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 00:38:40,164 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 00:38:40,164 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 00:38:40,164 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 00:38:40,166 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\validate_result.json
2025-04-26 00:38:40,166 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 00:38:40,166 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 00:38:40,166 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 00:38:40,167 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 00:38:40,167 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_sample_data.csv
2025-04-26 00:38:40,169 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 00:38:40,170 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_sample_data.csv
2025-04-26 00:38:40,170 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 00:38:40,172 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 00:38:40,172 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 00:38:40,173 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 00:38:40,173 - preprocess - INFO - Tỷ lệ mất cân bằng: 3.67
2025-04-26 00:38:40,174 - preprocess - INFO - Lớp hiếm nhất có 3 mẫu (3.00%)
2025-04-26 00:38:40,174 - preprocess - INFO - Lớp phổ biến nhất có 11 mẫu (11.00%)
2025-04-26 00:38:40,174 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 00:38:40,175 - preprocess - INFO - Số lượng lớp: 10
2025-04-26 00:38:40,175 - preprocess - INFO - Tỷ lệ mất cân bằng: 6.00
2025-04-26 00:38:40,175 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (3.12%)
2025-04-26 00:38:40,175 - preprocess - INFO - Lớp phổ biến nhất có 6 mẫu (18.75%)
2025-04-26 00:38:40,176 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 00:38:40,176 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 00:38:40,177 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 00:38:40,182 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_train_20250426_003840.csv
2025-04-26 00:38:40,182 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_test_20250426_003840.csv
2025-04-26 00:38:40,183 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_metadata_20250426_003840.json
2025-04-26 00:38:40,183 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_metadata_20250426_003840.json
2025-04-26 00:38:40,183 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 00:38:40,184 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_train_20250426_003840.csv
2025-04-26 00:38:40,184 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_test_20250426_003840.csv
2025-04-26 00:38:40,238 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 00:38:40,239 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 00:38:40,239 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 00:38:40,239 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 00:38:40,240 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 00:38:40,240 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 00:38:40,242 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_train_20250426_003840.csv
2025-04-26 00:38:40,243 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_6n0w5bih\test_customer_test_20250426_003840.csv
2025-04-26 00:38:40,244 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 00:38:40,244 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 00:38:40,247 - train - INFO - Tạo feature extractor...
2025-04-26 00:38:40,247 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 00:38:40,247 - train - INFO - Trích xuất đặc trưng...
2025-04-26 00:38:40,249 - train - ERROR - Lỗi khi huấn luyện mô hình: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1641, in train_customer_model
    trainer.train_hachtoan_model(train_df)
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 442, in train_hachtoan_model
    X_transformed = self.feature_extractor.fit_transform(X)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 232, in fit_transform
    return self.fit(df, y).transform(df)
           ^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 199, in fit
    self.column_transformer.fit(df)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\compose\_column_transformer.py", line 947, in fit
    self.fit_transform(X, y=y, **params)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\compose\_column_transformer.py", line 1001, in fit_transform
    result = self._call_func_on_transformers(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\compose\_column_transformer.py", line 910, in _call_func_on_transformers
    return Parallel(n_jobs=self.n_jobs)(jobs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\parallel.py", line 77, in __call__
    return super().__call__(iterable_with_config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\parallel.py", line 1918, in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\parallel.py", line 1847, in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\parallel.py", line 139, in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 1551, in _fit_transform_one
    res = transformer.fit_transform(X, y, **params.get("fit_transform", {}))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\base.py", line 1389, in wrapper
    return fit_method(estimator, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 718, in fit_transform
    Xt = self._fit(X, y, routed_params)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 588, in _fit
    X, fitted_transformer = fit_transform_one_cached(
                            ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\memory.py", line 312, in __call__
    return self.func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 1551, in _fit_transform_one
    res = transformer.fit_transform(X, y, **params.get("fit_transform", {}))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\base.py", line 918, in fit_transform
    return self.fit(X, **fit_params).transform(X)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\_set_output.py", line 319, in wrapped
    data_to_wrap = f(self, X, *args, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\preprocessing\_function_transformer.py", line 260, in transform
    out = self._transform(X, func=self.func, kw_args=self.kw_args)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\preprocessing\_function_transformer.py", line 387, in _transform
    return func(X, **(kw_args if kw_args else {}))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\utils\feature_extraction.py", line 86, in _preprocess_vietnamese_text
    return "" if pd.isna(text) else str(text)
                 ^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\pandas\core\generic.py", line 1577, in __nonzero__
    raise ValueError(
ValueError: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().
2025-04-26 00:38:40,477 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all().
2025-04-26 00:38:40,478 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 00:38:40,478 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 00:42:01,280 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 00:42:02,379 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 00:42:02,379 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm
2025-04-26 00:42:02,379 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 00:42:02,379 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 00:42:02,380 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 00:42:02,380 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 00:42:02,380 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 00:42:02,380 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 00:42:02,380 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 00:42:02,383 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_sample_data.csv
2025-04-26 00:42:02,383 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 00:42:02,383 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 00:42:02,383 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_sample_data.csv
2025-04-26 00:42:02,412 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 00:42:02,416 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: warnings
2025-04-26 00:42:02,416 - validate_data - INFO - Tổng số cảnh báo: 1
2025-04-26 00:42:02,417 - test_autobkp - INFO - Kết quả validate: warnings
2025-04-26 00:42:02,417 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\validate_result.json
2025-04-26 00:42:02,418 - test_autobkp - WARNING - Tìm thấy 1 cảnh báo trong dữ liệu
2025-04-26 00:42:02,418 - test_autobkp - WARNING - - Class imbalance detected in primary target (severity: medium)
2025-04-26 00:42:02,418 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 00:42:02,418 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 00:42:02,418 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 00:42:02,418 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 00:42:02,419 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_sample_data.csv
2025-04-26 00:42:02,420 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 00:42:02,420 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_sample_data.csv
2025-04-26 00:42:02,421 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 00:42:02,422 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 00:42:02,423 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 00:42:02,424 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 00:42:02,424 - preprocess - INFO - Tỷ lệ mất cân bằng: 12.00
2025-04-26 00:42:02,424 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (1.00%)
2025-04-26 00:42:02,424 - preprocess - INFO - Lớp phổ biến nhất có 12 mẫu (12.00%)
2025-04-26 00:42:02,424 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 00:42:02,425 - preprocess - INFO - Số lượng lớp: 9
2025-04-26 00:42:02,425 - preprocess - INFO - Tỷ lệ mất cân bằng: 5.00
2025-04-26 00:42:02,425 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (3.57%)
2025-04-26 00:42:02,425 - preprocess - INFO - Lớp phổ biến nhất có 5 mẫu (17.86%)
2025-04-26 00:42:02,425 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 00:42:02,426 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 00:42:02,426 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 00:42:02,436 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_train_20250426_004202.csv
2025-04-26 00:42:02,436 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_test_20250426_004202.csv
2025-04-26 00:42:02,436 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_metadata_20250426_004202.json
2025-04-26 00:42:02,437 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_metadata_20250426_004202.json
2025-04-26 00:42:02,437 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 00:42:02,437 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_train_20250426_004202.csv
2025-04-26 00:42:02,437 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_test_20250426_004202.csv
2025-04-26 00:42:02,470 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 00:42:02,471 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 00:42:02,472 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 00:42:02,472 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 00:42:02,472 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 00:42:02,472 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 00:42:02,474 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_train_20250426_004202.csv
2025-04-26 00:42:02,475 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_n82wbehm\test_customer_test_20250426_004202.csv
2025-04-26 00:42:02,476 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 00:42:02,476 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 00:42:02,478 - train - INFO - Tạo feature extractor...
2025-04-26 00:42:02,478 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 00:42:02,479 - train - INFO - Trích xuất đặc trưng...
2025-04-26 00:42:02,484 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 00:42:02,488 - train - INFO - Đã trích xuất 177 đặc trưng
2025-04-26 00:42:02,489 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 00:42:02,489 - train - INFO - Đã tự động chọn chiến lược: smote
2025-04-26 00:42:03,686 - train - ERROR - Lỗi khi xử lý mất cân bằng: Expected n_neighbors <= n_samples_fit, but n_neighbors = 6, n_samples_fit = 4, n_samples = 4
2025-04-26 00:42:03,686 - train - WARNING - Sử dụng dữ liệu gốc mà không xử lý mất cân bằng
2025-04-26 00:42:03,687 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 00:42:03,827 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 00:42:03,827 - train - INFO - Huấn luyện mô hình...
2025-04-26 00:42:03,829 - train - ERROR - Lỗi khi huấn luyện mô hình: Invalid classes inferred from unique values of `y`.  Expected: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14], got [1561 1562 1563 1564 1565 2111 2112 2113 2114 2115 3331 3332 3333 3334
 3335]
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1641, in train_customer_model
    trainer.train_hachtoan_model(train_df)
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 464, in train_hachtoan_model
    classifier.fit(X_balanced, y_balanced)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1640, in fit
    raise ValueError(
ValueError: Invalid classes inferred from unique values of `y`.  Expected: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14], got [1561 1562 1563 1564 1565 2111 2112 2113 2114 2115 3331 3332 3333 3334
 3335]
2025-04-26 00:42:03,854 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: Invalid classes inferred from unique values of `y`.  Expected: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14], got [1561 1562 1563 1564 1565 2111 2112 2113 2114 2115 3331 3332 3333 3334
 3335]
2025-04-26 00:42:03,854 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 00:42:03,854 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 00:53:26,340 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 00:53:27,415 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 00:53:27,415 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l
2025-04-26 00:53:27,415 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 00:53:27,416 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 00:53:27,416 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 00:53:27,416 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 00:53:27,416 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 00:53:27,416 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 00:53:27,416 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 00:53:27,419 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_sample_data.csv
2025-04-26 00:53:27,419 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 00:53:27,419 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 00:53:27,419 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_sample_data.csv
2025-04-26 00:53:27,446 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 00:53:27,450 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 00:53:27,450 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 00:53:27,450 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 00:53:27,453 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\validate_result.json
2025-04-26 00:53:27,453 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 00:53:27,453 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 00:53:27,453 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 00:53:27,454 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 00:53:27,454 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_sample_data.csv
2025-04-26 00:53:27,456 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 00:53:27,456 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_sample_data.csv
2025-04-26 00:53:27,457 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 00:53:27,458 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 00:53:27,459 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 00:53:27,459 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 00:53:27,459 - preprocess - INFO - Tỷ lệ mất cân bằng: 8.00
2025-04-26 00:53:27,459 - preprocess - INFO - Lớp hiếm nhất có 2 mẫu (2.00%)
2025-04-26 00:53:27,459 - preprocess - INFO - Lớp phổ biến nhất có 16 mẫu (16.00%)
2025-04-26 00:53:27,460 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 00:53:27,460 - preprocess - INFO - Số lượng lớp: 9
2025-04-26 00:53:27,460 - preprocess - INFO - Tỷ lệ mất cân bằng: 7.00
2025-04-26 00:53:27,460 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (2.94%)
2025-04-26 00:53:27,460 - preprocess - INFO - Lớp phổ biến nhất có 7 mẫu (20.59%)
2025-04-26 00:53:27,460 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 00:53:27,461 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 00:53:27,461 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 00:53:27,472 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_train_20250426_005327.csv
2025-04-26 00:53:27,473 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_test_20250426_005327.csv
2025-04-26 00:53:27,474 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_metadata_20250426_005327.json
2025-04-26 00:53:27,474 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_metadata_20250426_005327.json
2025-04-26 00:53:27,474 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 00:53:27,474 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_train_20250426_005327.csv
2025-04-26 00:53:27,474 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_test_20250426_005327.csv
2025-04-26 00:53:27,516 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 00:53:27,517 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 00:53:27,517 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 00:53:27,518 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 00:53:27,518 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 00:53:27,518 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 00:53:27,519 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_train_20250426_005327.csv
2025-04-26 00:53:27,520 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_r037_w3l\test_customer_test_20250426_005327.csv
2025-04-26 00:53:27,522 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 00:53:27,522 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 00:53:27,523 - train - INFO - Tạo feature extractor...
2025-04-26 00:53:27,523 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 00:53:27,525 - train - INFO - Trích xuất đặc trưng...
2025-04-26 00:53:27,530 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 00:53:27,534 - train - INFO - Đã trích xuất 181 đặc trưng
2025-04-26 00:53:27,535 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 00:53:27,535 - train - INFO - Đã tự động chọn chiến lược: smote
2025-04-26 00:53:27,749 - train - WARNING - Không đủ mẫu cho SMOTE (min_samples=0 < 6), sử dụng RandomOverSampler
2025-04-26 00:53:27,752 - train - INFO - Đã xử lý mất cân bằng: 80 -> 165 mẫu
2025-04-26 00:53:27,752 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 00:53:27,774 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 00:53:27,774 - train - INFO - Huấn luyện mô hình...
2025-04-26 00:53:27,775 - train - ERROR - Lỗi khi huấn luyện mô hình: Invalid classes inferred from unique values of `y`.  Expected: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14], got [1561 1562 1563 1564 1565 2111 2112 2113 2114 2115 3331 3332 3333 3334
 3335]
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1658, in train_customer_model
    trainer.train_hachtoan_model(train_df)
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 476, in train_hachtoan_model
    classifier.fit(X_balanced, y_balanced)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1640, in fit
    raise ValueError(
ValueError: Invalid classes inferred from unique values of `y`.  Expected: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14], got [1561 1562 1563 1564 1565 2111 2112 2113 2114 2115 3331 3332 3333 3334
 3335]
2025-04-26 00:53:27,777 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: Invalid classes inferred from unique values of `y`.  Expected: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14], got [1561 1562 1563 1564 1565 2111 2112 2113 2114 2115 3331 3332 3333 3334
 3335]
2025-04-26 00:53:27,777 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 00:53:27,777 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 01:05:08,722 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 01:05:09,897 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 01:05:09,897 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s
2025-04-26 01:05:09,897 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 01:05:09,897 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 01:05:09,897 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 01:05:09,897 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 01:05:09,898 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 01:05:09,898 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 01:05:09,898 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 01:05:09,900 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_sample_data.csv
2025-04-26 01:05:09,900 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 01:05:09,900 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 01:05:09,900 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_sample_data.csv
2025-04-26 01:05:09,927 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 01:05:09,930 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 01:05:09,930 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 01:05:09,932 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 01:05:09,933 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\validate_result.json
2025-04-26 01:05:09,933 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 01:05:09,933 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 01:05:09,933 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 01:05:09,933 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 01:05:09,934 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_sample_data.csv
2025-04-26 01:05:09,934 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 01:05:09,935 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_sample_data.csv
2025-04-26 01:05:09,936 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 01:05:09,937 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 01:05:09,938 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 01:05:09,939 - preprocess - INFO - Số lượng lớp: 14
2025-04-26 01:05:09,939 - preprocess - INFO - Tỷ lệ mất cân bằng: 3.67
2025-04-26 01:05:09,939 - preprocess - INFO - Lớp hiếm nhất có 3 mẫu (3.00%)
2025-04-26 01:05:09,939 - preprocess - INFO - Lớp phổ biến nhất có 11 mẫu (11.00%)
2025-04-26 01:05:09,939 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 01:05:09,940 - preprocess - INFO - Số lượng lớp: 10
2025-04-26 01:05:09,940 - preprocess - INFO - Tỷ lệ mất cân bằng: 8.00
2025-04-26 01:05:09,940 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (2.56%)
2025-04-26 01:05:09,940 - preprocess - INFO - Lớp phổ biến nhất có 8 mẫu (20.51%)
2025-04-26 01:05:09,940 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 01:05:09,940 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 01:05:09,940 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 01:05:09,947 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_train_20250426_010509.csv
2025-04-26 01:05:09,948 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_test_20250426_010509.csv
2025-04-26 01:05:09,949 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_metadata_20250426_010509.json
2025-04-26 01:05:09,949 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_metadata_20250426_010509.json
2025-04-26 01:05:09,949 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 01:05:09,949 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_train_20250426_010509.csv
2025-04-26 01:05:09,949 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_test_20250426_010509.csv
2025-04-26 01:05:09,990 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 01:05:09,990 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 01:05:09,991 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 01:05:09,991 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 01:05:09,991 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 01:05:09,991 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 01:05:09,992 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_train_20250426_010509.csv
2025-04-26 01:05:09,993 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_kwb7vl8s\test_customer_test_20250426_010509.csv
2025-04-26 01:05:09,995 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 01:05:09,995 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 01:05:09,996 - train - INFO - Tạo feature extractor...
2025-04-26 01:05:09,996 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 01:05:09,997 - train - INFO - Trích xuất đặc trưng...
2025-04-26 01:05:10,003 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 01:05:10,006 - train - INFO - Đã trích xuất 181 đặc trưng
2025-04-26 01:05:10,007 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 01:05:10,007 - train - INFO - Tỷ lệ mất cân bằng 3.33 <= 10, không cần xử lý
2025-04-26 01:05:10,007 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 01:05:10,029 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 01:05:10,031 - train - INFO - Huấn luyện mô hình...
2025-04-26 01:05:10,031 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 01:05:10,031 - train - INFO - Hoàn tất huấn luyện trong 0.04 giây
2025-04-26 01:05:10,032 - train - INFO - Bắt đầu huấn luyện mô hình MaHangHoa cho khách hàng test_customer
2025-04-26 01:05:10,033 - train - INFO - Lọc dữ liệu theo điều kiện: 31/80 dòng thỏa mãn
2025-04-26 01:05:10,033 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 01:05:10,034 - train - INFO - Mã hóa nhãn MaHangHoa từ kiểu object
2025-04-26 01:05:10,035 - train - INFO - Trích xuất đặc trưng...
2025-04-26 01:05:10,039 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 01:05:10,042 - train - INFO - Đã trích xuất 100 đặc trưng
2025-04-26 01:05:10,042 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 01:05:10,042 - train - INFO - Tỷ lệ mất cân bằng 8.00 <= 10, không cần xử lý
2025-04-26 01:05:10,042 - train - INFO - Tạo mô hình xgboost cho mahanghua_model
2025-04-26 01:05:10,042 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 01:05:10,043 - train - INFO - Huấn luyện mô hình...
2025-04-26 01:05:10,168 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 01:05:10,169 - train - INFO - Hoàn tất huấn luyện trong 0.14 giây
2025-04-26 01:05:10,171 - train - INFO - Bắt đầu huấn luyện mô hình phát hiện outlier cho khách hàng test_customer
2025-04-26 01:05:10,172 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 01:05:10,174 - train - INFO - Trích xuất đặc trưng cho phát hiện outlier...
2025-04-26 01:05:10,180 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 01:05:10,185 - train - INFO - Đã trích xuất 181 đặc trưng
2025-04-26 01:05:10,186 - train - INFO - Tạo mô hình phát hiện outlier isolation_forest
2025-04-26 01:05:10,256 - train - INFO - Huấn luyện mô hình phát hiện outlier...
2025-04-26 01:05:10,350 - train - INFO - Hoàn tất huấn luyện mô hình phát hiện outlier trong 0.18 giây
2025-04-26 01:05:10,351 - train - INFO - Lưu các mô hình đã huấn luyện cho khách hàng test_customer
2025-04-26 01:05:10,351 - train - ERROR - Lỗi khi huấn luyện mô hình: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.preprocess_fn at 0x000001F9FB0336A0>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.preprocess_fn
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1690, in train_customer_model
    saved_files = trainer.save_models()
                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 748, in save_models
    joblib.dump(self.hachtoan_model, hachtoan_path)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 553, in dump
    NumpyPickler(f, protocol=protocol).dump(value)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 481, in dump
    self.save(obj)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 1063, in save_global
    raise PicklingError(
_pickle.PicklingError: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.preprocess_fn at 0x000001F9FB0336A0>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.preprocess_fn
2025-04-26 01:05:10,380 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.preprocess_fn at 0x000001F9FB0336A0>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.preprocess_fn
2025-04-26 01:05:10,380 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 01:05:10,380 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 01:27:09,014 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 01:27:10,117 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 01:27:10,117 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku
2025-04-26 01:27:10,118 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 01:27:10,118 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 01:27:10,118 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 01:27:10,119 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 01:27:10,119 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 01:27:10,119 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 01:27:10,119 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 01:27:10,121 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_sample_data.csv
2025-04-26 01:27:10,121 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 01:27:10,122 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 01:27:10,122 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_sample_data.csv
2025-04-26 01:27:10,147 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 01:27:10,151 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 01:27:10,151 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 01:27:10,151 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 01:27:10,152 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\validate_result.json
2025-04-26 01:27:10,154 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 01:27:10,154 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 01:27:10,154 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 01:27:10,154 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 01:27:10,155 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_sample_data.csv
2025-04-26 01:27:10,156 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 01:27:10,156 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_sample_data.csv
2025-04-26 01:27:10,157 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 01:27:10,158 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 01:27:10,159 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 01:27:10,160 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 01:27:10,160 - preprocess - INFO - Tỷ lệ mất cân bằng: 4.67
2025-04-26 01:27:10,160 - preprocess - INFO - Lớp hiếm nhất có 3 mẫu (3.00%)
2025-04-26 01:27:10,160 - preprocess - INFO - Lớp phổ biến nhất có 14 mẫu (14.00%)
2025-04-26 01:27:10,161 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 01:27:10,161 - preprocess - INFO - Số lượng lớp: 9
2025-04-26 01:27:10,161 - preprocess - INFO - Tỷ lệ mất cân bằng: 3.00
2025-04-26 01:27:10,161 - preprocess - INFO - Lớp hiếm nhất có 2 mẫu (6.25%)
2025-04-26 01:27:10,161 - preprocess - INFO - Lớp phổ biến nhất có 6 mẫu (18.75%)
2025-04-26 01:27:10,162 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 01:27:10,162 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 01:27:10,163 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 01:27:10,172 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_train_20250426_012710.csv
2025-04-26 01:27:10,174 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_test_20250426_012710.csv
2025-04-26 01:27:10,175 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_metadata_20250426_012710.json
2025-04-26 01:27:10,175 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_metadata_20250426_012710.json
2025-04-26 01:27:10,175 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 01:27:10,175 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_train_20250426_012710.csv
2025-04-26 01:27:10,176 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_test_20250426_012710.csv
2025-04-26 01:27:10,219 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 01:27:10,219 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 01:27:10,220 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 01:27:10,220 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 01:27:10,220 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 01:27:10,220 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 01:27:10,221 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_train_20250426_012710.csv
2025-04-26 01:27:10,223 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_3g5se2ku\test_customer_test_20250426_012710.csv
2025-04-26 01:27:10,223 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 01:27:10,224 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 01:27:10,225 - train - INFO - Tạo feature extractor...
2025-04-26 01:27:10,225 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 01:27:10,226 - train - INFO - Trích xuất đặc trưng...
2025-04-26 01:27:10,232 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 01:27:10,235 - train - INFO - Đã trích xuất 182 đặc trưng
2025-04-26 01:27:10,236 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 01:27:10,236 - train - INFO - Đã tự động chọn chiến lược: class_weight
2025-04-26 01:27:10,236 - train - INFO - Sẽ sử dụng class_weight trong mô hình thay vì resampling
2025-04-26 01:27:10,236 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 01:27:10,267 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 01:27:10,267 - train - INFO - Huấn luyện mô hình...
2025-04-26 01:27:10,267 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 01:27:10,267 - train - INFO - Hoàn tất huấn luyện trong 0.04 giây
2025-04-26 01:27:10,268 - train - INFO - Bắt đầu huấn luyện mô hình MaHangHoa cho khách hàng test_customer
2025-04-26 01:27:10,269 - train - INFO - Lọc dữ liệu theo điều kiện: 28/80 dòng thỏa mãn
2025-04-26 01:27:10,269 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 01:27:10,270 - train - INFO - Mã hóa nhãn MaHangHoa từ kiểu object
2025-04-26 01:27:10,271 - train - INFO - Trích xuất đặc trưng...
2025-04-26 01:27:10,276 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 01:27:10,278 - train - INFO - Đã trích xuất 90 đặc trưng
2025-04-26 01:27:10,279 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 01:27:10,279 - train - INFO - Tỷ lệ mất cân bằng 6.00 <= 10, không cần xử lý
2025-04-26 01:27:10,279 - train - INFO - Tạo mô hình xgboost cho mahanghua_model
2025-04-26 01:27:10,280 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 01:27:10,280 - train - INFO - Huấn luyện mô hình...
2025-04-26 01:27:10,399 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 01:27:10,400 - train - INFO - Hoàn tất huấn luyện trong 0.13 giây
2025-04-26 01:27:10,401 - train - INFO - Bắt đầu huấn luyện mô hình phát hiện outlier cho khách hàng test_customer
2025-04-26 01:27:10,401 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 01:27:10,404 - train - INFO - Trích xuất đặc trưng cho phát hiện outlier...
2025-04-26 01:27:10,410 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 01:27:10,414 - train - INFO - Đã trích xuất 182 đặc trưng
2025-04-26 01:27:10,414 - train - INFO - Tạo mô hình phát hiện outlier isolation_forest
2025-04-26 01:27:10,480 - train - INFO - Huấn luyện mô hình phát hiện outlier...
2025-04-26 01:27:10,567 - train - INFO - Hoàn tất huấn luyện mô hình phát hiện outlier trong 0.17 giây
2025-04-26 01:27:10,568 - train - INFO - Lưu các mô hình đã huấn luyện cho khách hàng test_customer
2025-04-26 01:27:10,569 - train - ERROR - Lỗi khi huấn luyện mô hình: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.column_preprocessor at 0x00000113964C7740>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.column_preprocessor
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1690, in train_customer_model
    saved_files = trainer.save_models()
                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 748, in save_models
    joblib.dump(self.hachtoan_model, hachtoan_path)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 553, in dump
    NumpyPickler(f, protocol=protocol).dump(value)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 481, in dump
    self.save(obj)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 1063, in save_global
    raise PicklingError(
_pickle.PicklingError: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.column_preprocessor at 0x00000113964C7740>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.column_preprocessor
2025-04-26 01:27:10,575 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.column_preprocessor at 0x00000113964C7740>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.column_preprocessor
2025-04-26 01:27:10,575 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 01:27:10,575 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 09:32:16,008 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 09:32:17,563 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 09:32:17,563 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8
2025-04-26 09:32:17,565 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 09:32:17,565 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 09:32:17,565 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 09:32:17,565 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 09:32:17,565 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 09:32:17,565 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 09:32:17,566 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 09:32:17,568 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_sample_data.csv
2025-04-26 09:32:17,568 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 09:32:17,568 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 09:32:17,568 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_sample_data.csv
2025-04-26 09:32:17,605 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 09:32:17,611 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 09:32:17,611 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 09:32:17,611 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 09:32:17,612 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\validate_result.json
2025-04-26 09:32:17,614 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 09:32:17,614 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 09:32:17,614 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 09:32:17,614 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 09:32:17,615 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_sample_data.csv
2025-04-26 09:32:17,616 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 09:32:17,616 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_sample_data.csv
2025-04-26 09:32:17,617 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 09:32:17,618 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 09:32:17,619 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 09:32:17,619 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 09:32:17,620 - preprocess - INFO - Tỷ lệ mất cân bằng: 6.00
2025-04-26 09:32:17,620 - preprocess - INFO - Lớp hiếm nhất có 2 mẫu (2.00%)
2025-04-26 09:32:17,620 - preprocess - INFO - Lớp phổ biến nhất có 12 mẫu (12.00%)
2025-04-26 09:32:17,622 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 09:32:17,622 - preprocess - INFO - Số lượng lớp: 9
2025-04-26 09:32:17,622 - preprocess - INFO - Tỷ lệ mất cân bằng: 6.00
2025-04-26 09:32:17,622 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (3.33%)
2025-04-26 09:32:17,623 - preprocess - INFO - Lớp phổ biến nhất có 6 mẫu (20.00%)
2025-04-26 09:32:17,623 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 09:32:17,624 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 09:32:17,624 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 09:32:17,628 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_train_20250426_093217.csv
2025-04-26 09:32:17,629 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_test_20250426_093217.csv
2025-04-26 09:32:17,629 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_metadata_20250426_093217.json
2025-04-26 09:32:17,629 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_metadata_20250426_093217.json
2025-04-26 09:32:17,630 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 09:32:17,630 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_train_20250426_093217.csv
2025-04-26 09:32:17,630 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_test_20250426_093217.csv
2025-04-26 09:32:17,683 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 09:32:17,684 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 09:32:17,684 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 09:32:17,684 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 09:32:17,686 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 09:32:17,686 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 09:32:17,687 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_train_20250426_093217.csv
2025-04-26 09:32:17,688 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_jp0kljv8\test_customer_test_20250426_093217.csv
2025-04-26 09:32:17,689 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 09:32:17,689 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:32:17,691 - train - INFO - Tạo feature extractor...
2025-04-26 09:32:17,691 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 09:32:17,692 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:32:17,704 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:32:17,707 - train - INFO - Đã trích xuất 180 đặc trưng
2025-04-26 09:32:17,707 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:32:17,708 - train - INFO - Tỷ lệ mất cân bằng 4.50 <= 10, không cần xử lý
2025-04-26 09:32:17,709 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 09:32:17,757 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:32:17,757 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:32:17,757 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:32:17,758 - train - INFO - Hoàn tất huấn luyện trong 0.07 giây
2025-04-26 09:32:17,759 - train - INFO - Bắt đầu huấn luyện mô hình MaHangHoa cho khách hàng test_customer
2025-04-26 09:32:17,759 - train - INFO - Lọc dữ liệu theo điều kiện: 24/80 dòng thỏa mãn
2025-04-26 09:32:17,760 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:32:17,762 - train - INFO - Mã hóa nhãn MaHangHoa từ kiểu object
2025-04-26 09:32:17,762 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:32:17,766 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:32:17,768 - train - INFO - Đã trích xuất 78 đặc trưng
2025-04-26 09:32:17,768 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:32:17,769 - train - INFO - Tỷ lệ mất cân bằng 5.00 <= 10, không cần xử lý
2025-04-26 09:32:17,769 - train - INFO - Tạo mô hình xgboost cho mahanghua_model
2025-04-26 09:32:17,769 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:32:17,770 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:32:17,897 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:32:17,897 - train - INFO - Hoàn tất huấn luyện trong 0.14 giây
2025-04-26 09:32:17,899 - train - INFO - Bắt đầu huấn luyện mô hình phát hiện outlier cho khách hàng test_customer
2025-04-26 09:32:17,899 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:32:17,901 - train - INFO - Trích xuất đặc trưng cho phát hiện outlier...
2025-04-26 09:32:17,907 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:32:17,911 - train - INFO - Đã trích xuất 180 đặc trưng
2025-04-26 09:32:17,911 - train - INFO - Tạo mô hình phát hiện outlier isolation_forest
2025-04-26 09:32:18,012 - train - INFO - Huấn luyện mô hình phát hiện outlier...
2025-04-26 09:32:18,097 - train - INFO - Hoàn tất huấn luyện mô hình phát hiện outlier trong 0.20 giây
2025-04-26 09:32:18,098 - train - INFO - Lưu các mô hình đã huấn luyện cho khách hàng test_customer
2025-04-26 09:32:18,099 - train - ERROR - Lỗi khi huấn luyện mô hình: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.column_preprocessor at 0x0000028069BE7560>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.column_preprocessor
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 1690, in train_customer_model
    saved_files = trainer.save_models()
                  ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\train.py", line 748, in save_models
    joblib.dump(self.hachtoan_model, hachtoan_path)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 553, in dump
    NumpyPickler(f, protocol=protocol).dump(value)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 481, in dump
    self.save(obj)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 926, in save_list
    self._batch_appends(obj)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 950, in _batch_appends
    save(x)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 881, in save_tuple
    save(element)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 597, in save
    self.save_reduce(obj=obj, *rv)
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 711, in save_reduce
    save(state)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 966, in save_dict
    self._batch_setitems(obj.items())
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 990, in _batch_setitems
    save(v)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\joblib\numpy_pickle.py", line 355, in save
    return Pickler.save(self, obj)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 554, in save
    f(self, obj)  # Call unbound method with explicit self
    ^^^^^^^^^^^^
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\pickle.py", line 1063, in save_global
    raise PicklingError(
_pickle.PicklingError: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.column_preprocessor at 0x0000028069BE7560>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.column_preprocessor
2025-04-26 09:32:18,106 - test_autobkp - ERROR - Lỗi khi huấn luyện mô hình: Can't pickle <function FeatureExtractor._create_text_transformer.<locals>.column_preprocessor at 0x0000028069BE7560>: it's not found as app.utils.feature_extraction.FeatureExtractor._create_text_transformer.<locals>.column_preprocessor
2025-04-26 09:32:18,107 - test_autobkp - ERROR - ✗ Kiểm tra chức năng huấn luyện thất bại
2025-04-26 09:32:18,107 - test_autobkp - WARNING - Dừng các bài kiểm tra tiếp theo
2025-04-26 09:40:35,633 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 09:40:36,802 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 09:40:36,803 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s
2025-04-26 09:40:36,803 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 09:40:36,803 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 09:40:36,803 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 09:40:36,804 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 09:40:36,804 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 09:40:36,804 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 09:40:36,804 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 09:40:36,806 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_sample_data.csv
2025-04-26 09:40:36,807 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 09:40:36,807 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 09:40:36,807 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_sample_data.csv
2025-04-26 09:40:36,825 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 09:40:36,830 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 09:40:36,831 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 09:40:36,831 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 09:40:36,832 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\validate_result.json
2025-04-26 09:40:36,832 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 09:40:36,832 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 09:40:36,833 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 09:40:36,833 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 09:40:36,833 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_sample_data.csv
2025-04-26 09:40:36,835 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 09:40:36,835 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_sample_data.csv
2025-04-26 09:40:36,836 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 09:40:36,838 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 09:40:36,839 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 09:40:36,840 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 09:40:36,840 - preprocess - INFO - Tỷ lệ mất cân bằng: 3.00
2025-04-26 09:40:36,840 - preprocess - INFO - Lớp hiếm nhất có 3 mẫu (3.00%)
2025-04-26 09:40:36,841 - preprocess - INFO - Lớp phổ biến nhất có 9 mẫu (9.00%)
2025-04-26 09:40:36,841 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 09:40:36,842 - preprocess - INFO - Số lượng lớp: 8
2025-04-26 09:40:36,842 - preprocess - INFO - Tỷ lệ mất cân bằng: 9.00
2025-04-26 09:40:36,842 - preprocess - INFO - Lớp hiếm nhất có 1 mẫu (2.94%)
2025-04-26 09:40:36,842 - preprocess - INFO - Lớp phổ biến nhất có 9 mẫu (26.47%)
2025-04-26 09:40:36,843 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 09:40:36,844 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 09:40:36,844 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 09:40:36,848 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_train_20250426_094036.csv
2025-04-26 09:40:36,849 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_test_20250426_094036.csv
2025-04-26 09:40:36,849 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_metadata_20250426_094036.json
2025-04-26 09:40:36,849 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_metadata_20250426_094036.json
2025-04-26 09:40:36,849 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 09:40:36,851 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_train_20250426_094036.csv
2025-04-26 09:40:36,851 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_test_20250426_094036.csv
2025-04-26 09:40:36,895 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 09:40:36,895 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 09:40:36,895 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 09:40:36,896 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 09:40:36,896 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 09:40:36,896 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 09:40:36,897 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_train_20250426_094036.csv
2025-04-26 09:40:36,898 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_o_ffhg4s\test_customer_test_20250426_094036.csv
2025-04-26 09:40:36,899 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 09:40:36,900 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:40:36,901 - train - INFO - Tạo feature extractor...
2025-04-26 09:40:36,902 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 09:40:36,902 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:40:36,908 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:40:36,911 - train - INFO - Đã trích xuất 178 đặc trưng
2025-04-26 09:40:36,911 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:40:36,911 - train - INFO - Tỷ lệ mất cân bằng 4.50 <= 10, không cần xử lý
2025-04-26 09:40:36,913 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 09:40:36,938 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:40:36,939 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:40:36,939 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:40:36,939 - train - INFO - Hoàn tất huấn luyện trong 0.04 giây
2025-04-26 09:40:36,941 - train - INFO - Bắt đầu huấn luyện mô hình MaHangHoa cho khách hàng test_customer
2025-04-26 09:40:36,942 - train - INFO - Lọc dữ liệu theo điều kiện: 24/80 dòng thỏa mãn
2025-04-26 09:40:36,943 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:40:36,944 - train - INFO - Mã hóa nhãn MaHangHoa từ kiểu object
2025-04-26 09:40:36,944 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:40:36,948 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:40:36,951 - train - INFO - Đã trích xuất 84 đặc trưng
2025-04-26 09:40:36,951 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:40:36,952 - train - INFO - Tỷ lệ mất cân bằng 7.00 <= 10, không cần xử lý
2025-04-26 09:40:36,952 - train - INFO - Tạo mô hình xgboost cho mahanghua_model
2025-04-26 09:40:36,952 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:40:36,953 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:40:37,064 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:40:37,065 - train - INFO - Hoàn tất huấn luyện trong 0.12 giây
2025-04-26 09:40:37,067 - train - INFO - Bắt đầu huấn luyện mô hình phát hiện outlier cho khách hàng test_customer
2025-04-26 09:40:37,067 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:40:37,069 - train - INFO - Trích xuất đặc trưng cho phát hiện outlier...
2025-04-26 09:40:37,075 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:40:37,079 - train - INFO - Đã trích xuất 178 đặc trưng
2025-04-26 09:40:37,079 - train - INFO - Tạo mô hình phát hiện outlier isolation_forest
2025-04-26 09:40:37,150 - train - INFO - Huấn luyện mô hình phát hiện outlier...
2025-04-26 09:40:37,232 - train - INFO - Hoàn tất huấn luyện mô hình phát hiện outlier trong 0.17 giây
2025-04-26 09:40:37,232 - train - INFO - Lưu các mô hình đã huấn luyện cho khách hàng test_customer
2025-04-26 09:40:37,240 - train - INFO - Đã lưu mô hình HachToan: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_20250426_094036.joblib
2025-04-26 09:40:37,259 - train - INFO - Đã lưu mô hình MaHangHoa: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_20250426_094036.joblib
2025-04-26 09:40:37,291 - train - INFO - Đã lưu mô hình phát hiện outlier: D:\Python\AutoBKP_V2\volumes\models\test_customer\outlier\model_20250426_094036.joblib
2025-04-26 09:40:37,292 - train - INFO - Đã lưu label encoders: D:\Python\AutoBKP_V2\volumes\models\test_customer\encoders\label_encoders_20250426_094036.joblib
2025-04-26 09:40:37,299 - app.config.utils - INFO - Đã lưu metadata tại: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_20250426_094036.json
2025-04-26 09:40:37,313 - train - INFO - Đã lưu metadata: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_20250426_094036.json
2025-04-26 09:40:37,314 - train - INFO - Hoàn tất huấn luyện trong 0.42 giây
2025-04-26 09:40:37,315 - test_autobkp - INFO - Đã huấn luyện mô hình thành công trong 0.42 giây
2025-04-26 09:40:37,315 - test_autobkp - INFO - Mô hình HachToan: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_20250426_094036.joblib
2025-04-26 09:40:37,315 - test_autobkp - INFO - Mô hình MaHangHoa: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_20250426_094036.joblib
2025-04-26 09:40:37,315 - test_autobkp - INFO - Kiểm tra chức năng huấn luyện mô hình thành công
2025-04-26 09:40:37,316 - test_autobkp - INFO - ✓ Kiểm tra chức năng huấn luyện thành công
2025-04-26 09:40:37,316 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng dự đoán...
2025-04-26 09:40:37,496 - predict - INFO - Đã tải mô hình HachToan từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_latest.joblib
2025-04-26 09:40:37,526 - predict - INFO - Đã tải mô hình MaHangHoa từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_latest.joblib
2025-04-26 09:40:37,555 - predict - INFO - Đã tải mô hình phát hiện outlier từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\outlier\model_latest.joblib
2025-04-26 09:40:37,562 - predict - INFO - Đã tải label encoders từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\encoders\label_encoders_latest.joblib
2025-04-26 09:40:37,574 - predict - INFO - Đã tải metadata từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_latest.json
2025-04-26 09:40:37,580 - predict - ERROR - Lỗi khi dự đoán HachToan: Pipeline is not fitted yet.
2025-04-26 09:40:37,580 - test_autobkp - ERROR - Lỗi khi kiểm tra chức năng dự đoán: Pipeline is not fitted yet.
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 54, in _raise_or_warn_if_not_fitted
    yield
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 788, in predict
    return self.steps[-1][1].predict(Xt, **params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1718, in predict
    class_probs = super().predict(
                  ^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1327, in predict
    predts = self.get_booster().inplace_predict(
             ^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 922, in get_booster
    raise NotFittedError("need to call fit or load_model beforehand")
sklearn.exceptions.NotFittedError: need to call fit or load_model beforehand

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\test_autobkp.py", line 463, in test_predict
    single_result = predict_single_sample(self.customer_id, test_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 394, in predict_single_sample
    return predictor.predict(data)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 269, in predict
    hachtoan_pred = self.hachtoan_model.predict(df)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 782, in predict
    with _raise_or_warn_if_not_fitted(self):
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 56, in _raise_or_warn_if_not_fitted
    raise NotFittedError("Pipeline is not fitted yet.") from exc
sklearn.exceptions.NotFittedError: Pipeline is not fitted yet.
2025-04-26 09:40:37,600 - test_autobkp - ERROR - ✗ Kiểm tra chức năng dự đoán thất bại
2025-04-26 09:40:37,600 - test_autobkp - INFO - === KẾT THÚC CÁC BÀI KIỂM TRA ===
2025-04-26 09:40:37,600 - test_autobkp - INFO - Tổng kết: 5/6 bài kiểm tra thành công
2025-04-26 09:50:53,951 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 09:50:55,039 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 09:50:55,040 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos
2025-04-26 09:50:55,040 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 09:50:55,040 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 09:50:55,040 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 09:50:55,040 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 09:50:55,041 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 09:50:55,041 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 09:50:55,041 - test_autobkp - INFO - Bắt đầu tạo 100 dòng dữ liệu mẫu...
2025-04-26 09:50:55,044 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_sample_data.csv
2025-04-26 09:50:55,044 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 09:50:55,044 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 09:50:55,044 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_sample_data.csv
2025-04-26 09:50:55,077 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 09:50:55,080 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 09:50:55,080 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 09:50:55,080 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 09:50:55,081 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\validate_result.json
2025-04-26 09:50:55,081 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 09:50:55,081 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 09:50:55,083 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 09:50:55,083 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 09:50:55,084 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_sample_data.csv
2025-04-26 09:50:55,085 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 09:50:55,085 - preprocess - INFO - Đã đọc 100 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_sample_data.csv
2025-04-26 09:50:55,085 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 09:50:55,087 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 09:50:55,088 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 09:50:55,088 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 09:50:55,089 - preprocess - INFO - Tỷ lệ mất cân bằng: 2.50
2025-04-26 09:50:55,089 - preprocess - INFO - Lớp hiếm nhất có 4 mẫu (4.00%)
2025-04-26 09:50:55,089 - preprocess - INFO - Lớp phổ biến nhất có 10 mẫu (10.00%)
2025-04-26 09:50:55,090 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 09:50:55,090 - preprocess - INFO - Số lượng lớp: 9
2025-04-26 09:50:55,091 - preprocess - INFO - Tỷ lệ mất cân bằng: 3.00
2025-04-26 09:50:55,091 - preprocess - INFO - Lớp hiếm nhất có 2 mẫu (5.41%)
2025-04-26 09:50:55,091 - preprocess - INFO - Lớp phổ biến nhất có 6 mẫu (16.22%)
2025-04-26 09:50:55,091 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 09:50:55,092 - preprocess - INFO - Tập huấn luyện: 80 mẫu
2025-04-26 09:50:55,092 - preprocess - INFO - Tập kiểm tra: 20 mẫu
2025-04-26 09:50:55,099 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_train_20250426_095055.csv
2025-04-26 09:50:55,099 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_test_20250426_095055.csv
2025-04-26 09:50:55,100 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_metadata_20250426_095055.json
2025-04-26 09:50:55,100 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_metadata_20250426_095055.json
2025-04-26 09:50:55,100 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 09:50:55,100 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_train_20250426_095055.csv
2025-04-26 09:50:55,101 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_test_20250426_095055.csv
2025-04-26 09:50:55,148 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 80
2025-04-26 09:50:55,148 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 20
2025-04-26 09:50:55,148 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 09:50:55,148 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 09:50:55,149 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 09:50:55,149 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 09:50:55,150 - train - INFO - Đã đọc 80 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_train_20250426_095055.csv
2025-04-26 09:50:55,152 - train - INFO - Đã đọc 20 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_6us9ywos\test_customer_test_20250426_095055.csv
2025-04-26 09:50:55,153 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 09:50:55,153 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:50:55,154 - train - INFO - Tạo feature extractor...
2025-04-26 09:50:55,155 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 09:50:55,155 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:50:55,160 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:50:55,163 - train - INFO - Đã trích xuất 184 đặc trưng
2025-04-26 09:50:55,163 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:50:55,164 - train - INFO - Tỷ lệ mất cân bằng 4.50 <= 10, không cần xử lý
2025-04-26 09:50:55,164 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 09:50:55,189 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:50:55,190 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:50:55,190 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:50:55,190 - train - INFO - Hoàn tất huấn luyện trong 0.04 giây
2025-04-26 09:50:55,191 - train - INFO - Bắt đầu huấn luyện mô hình MaHangHoa cho khách hàng test_customer
2025-04-26 09:50:55,192 - train - INFO - Lọc dữ liệu theo điều kiện: 28/80 dòng thỏa mãn
2025-04-26 09:50:55,192 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:50:55,193 - train - INFO - Mã hóa nhãn MaHangHoa từ kiểu object
2025-04-26 09:50:55,194 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:50:55,197 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:50:55,199 - train - INFO - Đã trích xuất 82 đặc trưng
2025-04-26 09:50:55,200 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:50:55,200 - train - INFO - Tỷ lệ mất cân bằng 2.50 <= 10, không cần xử lý
2025-04-26 09:50:55,201 - train - INFO - Tạo mô hình xgboost cho mahanghua_model
2025-04-26 09:50:55,201 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:50:55,201 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:50:55,313 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:50:55,313 - train - INFO - Hoàn tất huấn luyện trong 0.12 giây
2025-04-26 09:50:55,315 - train - INFO - Bắt đầu huấn luyện mô hình phát hiện outlier cho khách hàng test_customer
2025-04-26 09:50:55,315 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:50:55,317 - train - INFO - Trích xuất đặc trưng cho phát hiện outlier...
2025-04-26 09:50:55,323 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:50:55,327 - train - INFO - Đã trích xuất 184 đặc trưng
2025-04-26 09:50:55,327 - train - INFO - Tạo mô hình phát hiện outlier isolation_forest
2025-04-26 09:50:55,394 - train - INFO - Huấn luyện mô hình phát hiện outlier...
2025-04-26 09:50:55,483 - train - INFO - Hoàn tất huấn luyện mô hình phát hiện outlier trong 0.17 giây
2025-04-26 09:50:55,483 - train - INFO - Lưu các mô hình đã huấn luyện cho khách hàng test_customer
2025-04-26 09:50:55,486 - train - INFO - Đã lưu mô hình HachToan: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_20250426_095055.joblib
2025-04-26 09:50:55,507 - train - INFO - Đã lưu mô hình MaHangHoa: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_20250426_095055.joblib
2025-04-26 09:50:55,536 - train - INFO - Đã lưu mô hình phát hiện outlier: D:\Python\AutoBKP_V2\volumes\models\test_customer\outlier\model_20250426_095055.joblib
2025-04-26 09:50:55,539 - train - INFO - Đã lưu label encoders: D:\Python\AutoBKP_V2\volumes\models\test_customer\encoders\label_encoders_20250426_095055.joblib
2025-04-26 09:50:55,543 - app.config.utils - INFO - Đã lưu metadata tại: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_20250426_095055.json
2025-04-26 09:50:55,557 - train - INFO - Đã lưu metadata: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_20250426_095055.json
2025-04-26 09:50:55,558 - train - INFO - Hoàn tất huấn luyện trong 0.41 giây
2025-04-26 09:50:55,560 - test_autobkp - INFO - Đã huấn luyện mô hình thành công trong 0.41 giây
2025-04-26 09:50:55,560 - test_autobkp - INFO - Mô hình HachToan: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_20250426_095055.joblib
2025-04-26 09:50:55,560 - test_autobkp - INFO - Mô hình MaHangHoa: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_20250426_095055.joblib
2025-04-26 09:50:55,560 - test_autobkp - INFO - Kiểm tra chức năng huấn luyện mô hình thành công
2025-04-26 09:50:55,561 - test_autobkp - INFO - ✓ Kiểm tra chức năng huấn luyện thành công
2025-04-26 09:50:55,561 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng dự đoán...
2025-04-26 09:50:55,722 - predict - INFO - Đã tải mô hình HachToan từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_latest.joblib
2025-04-26 09:50:55,722 - predict - WARNING - Không thể kiểm tra trạng thái fit của mô hình: 'XGBClassifier' object has no attribute '_Booster'
2025-04-26 09:50:55,752 - predict - INFO - Đã tải mô hình MaHangHoa từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_latest.joblib
2025-04-26 09:50:55,789 - predict - INFO - Đã tải mô hình phát hiện outlier từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\outlier\model_latest.joblib
2025-04-26 09:50:55,799 - predict - INFO - Đã tải label encoders từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\encoders\label_encoders_latest.joblib
2025-04-26 09:50:55,813 - predict - INFO - Đã tải metadata từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_latest.json
2025-04-26 09:50:55,817 - predict - WARNING - Lỗi khi sử dụng predict trực tiếp: Pipeline is not fitted yet.. Thử phương pháp thay thế.
2025-04-26 09:50:55,817 - predict - ERROR - Lỗi khi dự đoán HachToan: This 'Pipeline' has no attribute 'transform'
2025-04-26 09:50:55,818 - test_autobkp - ERROR - Lỗi khi kiểm tra chức năng dự đoán: This 'Pipeline' has no attribute 'transform'
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 54, in _raise_or_warn_if_not_fitted
    yield
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 788, in predict
    return self.steps[-1][1].predict(Xt, **params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1718, in predict
    class_probs = super().predict(
                  ^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1327, in predict
    predts = self.get_booster().inplace_predict(
             ^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 922, in get_booster
    raise NotFittedError("need to call fit or load_model beforehand")
sklearn.exceptions.NotFittedError: need to call fit or load_model beforehand

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 317, in predict
    hachtoan_pred = self.hachtoan_model.predict(df)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 782, in predict
    with _raise_or_warn_if_not_fitted(self):
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 56, in _raise_or_warn_if_not_fitted
    raise NotFittedError("Pipeline is not fitted yet.") from exc
sklearn.exceptions.NotFittedError: Pipeline is not fitted yet.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\test_autobkp.py", line 463, in test_predict
    single_result = predict_single_sample(self.customer_id, test_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 492, in predict_single_sample
    return predictor.predict(data)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 324, in predict
    X_transformed = self.hachtoan_model.transform_df(df)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 141, in transform_df
    return pipeline.transform(X)
           ^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\_available_if.py", line 43, in __get__
    self._check(obj, owner=owner)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\_available_if.py", line 37, in _check
    raise AttributeError(attr_err_msg)
AttributeError: This 'Pipeline' has no attribute 'transform'
2025-04-26 09:50:55,835 - test_autobkp - ERROR - ✗ Kiểm tra chức năng dự đoán thất bại
2025-04-26 09:50:55,835 - test_autobkp - INFO - === KẾT THÚC CÁC BÀI KIỂM TRA ===
2025-04-26 09:50:55,836 - test_autobkp - INFO - Tổng kết: 5/6 bài kiểm tra thành công
2025-04-26 09:53:31,613 - config_manager - INFO - Đã tải cấu hình mặc định
2025-04-26 09:53:32,691 - test_autobkp - INFO - Đã khởi tạo AutoBKPTester với customer_id: test_customer
2025-04-26 09:53:32,692 - test_autobkp - INFO - Thư mục tạm: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj
2025-04-26 09:53:32,692 - test_autobkp - INFO - === BẮT ĐẦU CHẠY TẤT CẢ CÁC BÀI KIỂM TRA ===
2025-04-26 09:53:32,692 - test_autobkp - INFO - Bắt đầu kiểm tra cấu hình...
2025-04-26 09:53:32,692 - test_autobkp - INFO - Đã tải cấu hình mặc định thành công
2025-04-26 09:53:32,692 - test_autobkp - INFO - Đã tải cấu hình khách hàng test_customer thành công
2025-04-26 09:53:32,693 - test_autobkp - INFO - Kiểm tra cấu hình thành công
2025-04-26 09:53:32,693 - test_autobkp - INFO - ✓ Kiểm tra cấu hình thành công
2025-04-26 09:53:32,693 - test_autobkp - INFO - Bắt đầu tạo 1000 dòng dữ liệu mẫu...
2025-04-26 09:53:32,700 - test_autobkp - INFO - Đã tạo dữ liệu mẫu và lưu vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_sample_data.csv
2025-04-26 09:53:32,701 - test_autobkp - INFO - ✓ Tạo dữ liệu mẫu thành công
2025-04-26 09:53:32,701 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng validate_data...
2025-04-26 09:53:32,701 - validate_data - INFO - Bắt đầu kiểm tra tính hợp lệ của dữ liệu từ file C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_sample_data.csv
2025-04-26 09:53:32,748 - validate_data - INFO - Đã đọc file CSV với encoding utf-8
2025-04-26 09:53:32,754 - validate_data - INFO - Hoàn tất kiểm tra. Trạng thái: valid
2025-04-26 09:53:32,754 - validate_data - INFO - Tổng số cảnh báo: 0
2025-04-26 09:53:32,754 - test_autobkp - INFO - Kết quả validate: valid
2025-04-26 09:53:32,755 - test_autobkp - INFO - Đã lưu kết quả validate vào: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\validate_result.json
2025-04-26 09:53:32,755 - test_autobkp - INFO - Kiểm tra chức năng validate_data thành công
2025-04-26 09:53:32,755 - test_autobkp - INFO - ✓ Kiểm tra chức năng validate_data thành công
2025-04-26 09:53:32,755 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng tiền xử lý dữ liệu...
2025-04-26 09:53:32,755 - preprocess - INFO - Bắt đầu tiền xử lý dữ liệu cho khách hàng test_customer
2025-04-26 09:53:32,756 - preprocess - INFO - Đọc dữ liệu từ: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_sample_data.csv
2025-04-26 09:53:32,759 - preprocess - INFO - Đọc thành công với encoding: utf-8
2025-04-26 09:53:32,759 - preprocess - INFO - Đã đọc 1000 dòng dữ liệu từ C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_sample_data.csv
2025-04-26 09:53:32,760 - preprocess - INFO - Tiền xử lý cột văn bản tiếng Việt: TenHangHoaDichVu
2025-04-26 09:53:32,767 - preprocess - INFO - Tiền xử lý cột ID: MSTNguoiBan
2025-04-26 09:53:32,768 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: HachToan
2025-04-26 09:53:32,769 - preprocess - INFO - Số lượng lớp: 15
2025-04-26 09:53:32,769 - preprocess - INFO - Tỷ lệ mất cân bằng: 1.26
2025-04-26 09:53:32,769 - preprocess - INFO - Lớp hiếm nhất có 61 mẫu (6.10%)
2025-04-26 09:53:32,769 - preprocess - INFO - Lớp phổ biến nhất có 77 mẫu (7.70%)
2025-04-26 09:53:32,770 - preprocess - INFO - Phân tích phân phối của biến mục tiêu: MaHangHoa
2025-04-26 09:53:32,770 - preprocess - INFO - Số lượng lớp: 10
2025-04-26 09:53:32,770 - preprocess - INFO - Tỷ lệ mất cân bằng: 1.77
2025-04-26 09:53:32,770 - preprocess - INFO - Lớp hiếm nhất có 26 mẫu (7.62%)
2025-04-26 09:53:32,771 - preprocess - INFO - Lớp phổ biến nhất có 46 mẫu (13.49%)
2025-04-26 09:53:32,771 - preprocess - INFO - Phân chia dữ liệu với test_size=0.2
2025-04-26 09:53:32,771 - preprocess - INFO - Tập huấn luyện: 800 mẫu
2025-04-26 09:53:32,771 - preprocess - INFO - Tập kiểm tra: 200 mẫu
2025-04-26 09:53:32,784 - preprocess - INFO - Đã lưu tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_train_20250426_095332.csv
2025-04-26 09:53:32,784 - preprocess - INFO - Đã lưu tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_test_20250426_095332.csv
2025-04-26 09:53:32,785 - app.config.utils - INFO - Đã lưu metadata tại: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_metadata_20250426_095332.json
2025-04-26 09:53:32,785 - preprocess - INFO - Đã lưu metadata: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_metadata_20250426_095332.json
2025-04-26 09:53:32,785 - test_autobkp - INFO - Đã tiền xử lý dữ liệu thành công
2025-04-26 09:53:32,786 - test_autobkp - INFO - - Tập huấn luyện: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_train_20250426_095332.csv
2025-04-26 09:53:32,786 - test_autobkp - INFO - - Tập kiểm tra: C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_test_20250426_095332.csv
2025-04-26 09:53:32,841 - test_autobkp - INFO - Số lượng mẫu trong tập huấn luyện: 800
2025-04-26 09:53:32,841 - test_autobkp - INFO - Số lượng mẫu trong tập kiểm tra: 200
2025-04-26 09:53:32,841 - test_autobkp - INFO - Kiểm tra chức năng tiền xử lý dữ liệu thành công
2025-04-26 09:53:32,843 - test_autobkp - INFO - ✓ Kiểm tra chức năng tiền xử lý thành công
2025-04-26 09:53:32,843 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng huấn luyện mô hình...
2025-04-26 09:53:32,843 - train - INFO - Bắt đầu huấn luyện mô hình cho khách hàng test_customer
2025-04-26 09:53:32,846 - train - INFO - Đã đọc 800 dòng dữ liệu huấn luyện từ C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_train_20250426_095332.csv
2025-04-26 09:53:32,847 - train - INFO - Đã đọc 200 dòng dữ liệu kiểm tra từ C:\Users\trant\AppData\Local\Temp\autobkp_test_efry0snj\test_customer_test_20250426_095332.csv
2025-04-26 09:53:32,847 - train - INFO - Bắt đầu huấn luyện mô hình HachToan cho khách hàng test_customer
2025-04-26 09:53:32,847 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:53:32,854 - train - INFO - Tạo feature extractor...
2025-04-26 09:53:32,854 - app.utils.feature_extraction - WARNING - Không tìm thấy thư viện xử lý tiếng Việt (underthesea, pyvi). Chức năng xử lý tiếng Việt sẽ bị hạn chế.
2025-04-26 09:53:32,855 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:53:32,878 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:53:32,897 - train - INFO - Đã trích xuất 950 đặc trưng
2025-04-26 09:53:32,898 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:53:32,898 - train - INFO - Tỷ lệ mất cân bằng 1.49 <= 10, không cần xử lý
2025-04-26 09:53:32,899 - train - INFO - Tạo mô hình xgboost cho hachtoan_model
2025-04-26 09:53:32,921 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:53:32,923 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:53:32,923 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:53:32,924 - train - INFO - Hoàn tất huấn luyện trong 0.08 giây
2025-04-26 09:53:32,925 - train - INFO - Bắt đầu huấn luyện mô hình MaHangHoa cho khách hàng test_customer
2025-04-26 09:53:32,925 - train - INFO - Lọc dữ liệu theo điều kiện: 269/800 dòng thỏa mãn
2025-04-26 09:53:32,926 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:53:32,929 - train - INFO - Mã hóa nhãn MaHangHoa từ kiểu object
2025-04-26 09:53:32,929 - train - INFO - Trích xuất đặc trưng...
2025-04-26 09:53:32,938 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:53:32,944 - train - INFO - Đã trích xuất 412 đặc trưng
2025-04-26 09:53:32,945 - train - INFO - Xử lý mất cân bằng dữ liệu với chiến lược: auto
2025-04-26 09:53:32,945 - train - INFO - Tỷ lệ mất cân bằng 1.76 <= 10, không cần xử lý
2025-04-26 09:53:32,945 - train - INFO - Tạo mô hình xgboost cho mahanghua_model
2025-04-26 09:53:32,945 - train - INFO - Đã tạo mô hình XGBoost với tham số: {'n_estimators': 100, 'max_depth': 6, 'learning_rate': 0.1, 'objective': 'multi:softprob', 'n_jobs': -1, 'random_state': 42}
2025-04-26 09:53:32,945 - train - INFO - Huấn luyện mô hình...
2025-04-26 09:53:33,474 - train - INFO - Tạo pipeline kết hợp feature extractor và classifier
2025-04-26 09:53:33,475 - train - INFO - Hoàn tất huấn luyện trong 0.55 giây
2025-04-26 09:53:33,479 - train - INFO - Bắt đầu huấn luyện mô hình phát hiện outlier cho khách hàng test_customer
2025-04-26 09:53:33,479 - train - INFO - Tiền xử lý dữ liệu...
2025-04-26 09:53:33,487 - train - INFO - Trích xuất đặc trưng cho phát hiện outlier...
2025-04-26 09:53:33,519 - app.utils.feature_extraction - WARNING - Lỗi khi lấy tên đặc trưng từ transformer text_TenHangHoaDichVu: Estimator preprocess does not provide get_feature_names_out. Did you mean to call pipeline[:-1].get_feature_names_out()?
2025-04-26 09:53:33,547 - train - INFO - Đã trích xuất 950 đặc trưng
2025-04-26 09:53:33,547 - train - INFO - Tạo mô hình phát hiện outlier isolation_forest
2025-04-26 09:53:33,606 - train - INFO - Huấn luyện mô hình phát hiện outlier...
2025-04-26 09:53:33,701 - train - INFO - Hoàn tất huấn luyện mô hình phát hiện outlier trong 0.22 giây
2025-04-26 09:53:33,701 - train - INFO - Lưu các mô hình đã huấn luyện cho khách hàng test_customer
2025-04-26 09:53:33,707 - train - INFO - Đã lưu mô hình HachToan: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_20250426_095332.joblib
2025-04-26 09:53:33,732 - train - INFO - Đã lưu mô hình MaHangHoa: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_20250426_095332.joblib
2025-04-26 09:53:33,764 - train - INFO - Đã lưu mô hình phát hiện outlier: D:\Python\AutoBKP_V2\volumes\models\test_customer\outlier\model_20250426_095332.joblib
2025-04-26 09:53:33,765 - train - INFO - Đã lưu label encoders: D:\Python\AutoBKP_V2\volumes\models\test_customer\encoders\label_encoders_20250426_095332.joblib
2025-04-26 09:53:33,770 - app.config.utils - INFO - Đã lưu metadata tại: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_20250426_095332.json
2025-04-26 09:53:33,783 - train - INFO - Đã lưu metadata: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_20250426_095332.json
2025-04-26 09:53:33,784 - train - INFO - Hoàn tất huấn luyện trong 0.94 giây
2025-04-26 09:53:33,785 - test_autobkp - INFO - Đã huấn luyện mô hình thành công trong 0.94 giây
2025-04-26 09:53:33,786 - test_autobkp - INFO - Mô hình HachToan: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_20250426_095332.joblib
2025-04-26 09:53:33,786 - test_autobkp - INFO - Mô hình MaHangHoa: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_20250426_095332.joblib
2025-04-26 09:53:33,786 - test_autobkp - INFO - Kiểm tra chức năng huấn luyện mô hình thành công
2025-04-26 09:53:33,786 - test_autobkp - INFO - ✓ Kiểm tra chức năng huấn luyện thành công
2025-04-26 09:53:33,786 - test_autobkp - INFO - Bắt đầu kiểm tra chức năng dự đoán...
2025-04-26 09:53:33,882 - predict - INFO - Đã tải mô hình HachToan từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\hachtoan\model_latest.joblib
2025-04-26 09:53:33,882 - predict - WARNING - Không thể kiểm tra trạng thái fit của mô hình: 'XGBClassifier' object has no attribute '_Booster'
2025-04-26 09:53:33,917 - predict - INFO - Đã tải mô hình MaHangHoa từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\mahanghua\model_latest.joblib
2025-04-26 09:53:33,984 - predict - INFO - Đã tải mô hình phát hiện outlier từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\outlier\model_latest.joblib
2025-04-26 09:53:33,993 - predict - INFO - Đã tải label encoders từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\encoders\label_encoders_latest.joblib
2025-04-26 09:53:34,003 - predict - INFO - Đã tải metadata từ: D:\Python\AutoBKP_V2\volumes\models\test_customer\metadata\model_metadata_latest.json
2025-04-26 09:53:34,010 - predict - WARNING - Lỗi khi sử dụng predict trực tiếp: Pipeline is not fitted yet.. Thử phương pháp thay thế.
2025-04-26 09:53:34,010 - predict - ERROR - Lỗi khi dự đoán HachToan: This 'Pipeline' has no attribute 'transform'
2025-04-26 09:53:34,010 - test_autobkp - ERROR - Lỗi khi kiểm tra chức năng dự đoán: This 'Pipeline' has no attribute 'transform'
Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 54, in _raise_or_warn_if_not_fitted
    yield
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 788, in predict
    return self.steps[-1][1].predict(Xt, **params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1718, in predict
    class_probs = super().predict(
                  ^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\core.py", line 729, in inner_f
    return func(**kwargs)
           ^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 1327, in predict
    predts = self.get_booster().inplace_predict(
             ^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\xgboost\sklearn.py", line 922, in get_booster
    raise NotFittedError("need to call fit or load_model beforehand")
sklearn.exceptions.NotFittedError: need to call fit or load_model beforehand

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 317, in predict
    hachtoan_pred = self.hachtoan_model.predict(df)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 782, in predict
    with _raise_or_warn_if_not_fitted(self):
  File "C:\Users\trant\AppData\Local\Programs\Python\Python312\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\pipeline.py", line 56, in _raise_or_warn_if_not_fitted
    raise NotFittedError("Pipeline is not fitted yet.") from exc
sklearn.exceptions.NotFittedError: Pipeline is not fitted yet.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Python\AutoBKP_V2\test_autobkp.py", line 463, in test_predict
    single_result = predict_single_sample(self.customer_id, test_data)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 492, in predict_single_sample
    return predictor.predict(data)
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 324, in predict
    X_transformed = self.hachtoan_model.transform_df(df)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\app\scripts\predict.py", line 141, in transform_df
    return pipeline.transform(X)
           ^^^^^^^^^^^^^^^^^^
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\_available_if.py", line 43, in __get__
    self._check(obj, owner=owner)
  File "D:\Python\AutoBKP_V2\.venv\Lib\site-packages\sklearn\utils\_available_if.py", line 37, in _check
    raise AttributeError(attr_err_msg)
AttributeError: This 'Pipeline' has no attribute 'transform'
2025-04-26 09:53:34,014 - test_autobkp - ERROR - ✗ Kiểm tra chức năng dự đoán thất bại
2025-04-26 09:53:34,014 - test_autobkp - INFO - === KẾT THÚC CÁC BÀI KIỂM TRA ===
2025-04-26 09:53:34,014 - test_autobkp - INFO - Tổng kết: 5/6 bài kiểm tra thành công
